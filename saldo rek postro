SELECT 
	DPK.AS_OF_DATE 
	,DPK.CIF_KEY AS CIF
        ,TRIM(COALESCE(CUS.CUSTOMER_NAME, CUS.COMPANY_NAME, '')) AS NAMA_REKENING
	,CUS.ID_NUMBER AS BIC
	,DPK.CURRENCY AS CCY
	,DPK.ID_NUMBER AS NO_REKENING
	,DPK.CUR_BOOK_BAL AS SALDO_AKHIR_ORG
	,DPK.CUR_BOOK_BAL_IDR AS SALDO_AKHIR_IDR
FROM acl_datalake.mart_dpk DPK 
LEFT JOIN acl_datalake.mart_customer  CUS 
		ON CUS.CIF_KEY=DPK.CIF_KEY AND CAST('tanggal_posisi' AS DATE FORMAT 'YYYY-MM-DD') BETWEEN CUS.START_DATE AND CUS.END_DATE
WHERE DPK.AS_OF_DATE=CAST('tanggal_posisi' AS DATE FORMAT 'YYYY-MM-DD')
AND DPK.ACCOUNT_TYPE='1260'
AND DPK.BRANCH_CODE=766
AND DPK.DEP_FLAG='DEPOSIT';
